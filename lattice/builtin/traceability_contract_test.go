package builtin

import (
	"fmt"
	"github.com/LatticeBCLab/go-lattice/common/convert"
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestTraceabilityContract_Write(t *testing.T) {
	contract := NewTraceabilityContract()
	code, err := contract.Write(&WriteTraceabilityRequest{
		TraceabilityId: "1",
		ProtocolUri:    2,
		Hash:           "0xm6b7fIRQghMt4aZYIBxMLENAA18kRTQ4ibY16oKW1oepH7dFjESF8VPPhUXINe70",
		Data: [][32]byte{
			{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		},
		Address: convert.ZltcMustToAddress("zltc_TAaV5f9K9mmC2LfWiouw8iyPpRyXCN2nv"),
	})
	assert.NoError(t, err)
	expect := "0x6b85488b00000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001600000000000000000000000001f02f716a79f47ca9700c6c41a636ff7e5693ebb00000000000000000000000000000000000000000000000000000000000000013100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004230786d3662376649525167684d7434615a594942784d4c454e414131386b5254513469625931366f4b57316f6570483764466a45534638565050685558494e65373000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000"
	assert.Equal(t, expect, code)

}
func TestTraceabilityContract_Read(t *testing.T) {
	contract := NewTraceabilityContract()
	code, err := contract.Read("1")
	assert.NoError(t, err)
	fmt.Println(code)
	expect := "0x057a16a3000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000013100000000000000000000000000000000000000000000000000000000000000"
	assert.Equal(t, expect, code)
}
