package builtin

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/assert"
	"github.com/wylu1037/lattice-go/common/types"
	"testing"
)

func TestContractManagementContract_SetManagementRules(t *testing.T) {
	contract := NewContractManagementContract()
	req := SetContractManagementRulesRequest{
		Address: common.HexToAddress("0x5f2be9a02b43f748ee460bf36eed24fafa109920"),
		ContractManagementRules: ContractManagementRules{
			PermissionMode: types.ContractManagementModeBLACKLIST,
			Threshold:      100,
			BlackList:      []common.Address{},
			WhiteList:      []common.Address{common.HexToAddress("0x9293c604c644bfac34f498998cc3402f203d4d6b")},
			ManagerList: []WeightDistribution{
				{Address: common.HexToAddress("0x9293c604c644bfac34f498998cc3402f203d4d6b"), Weight: 100},
			},
		},
	}
	data, err := contract.SetManagementRules(&req)
	assert.Nil(t, err)
	expect := "0xf2aefd870000000000000000000000005f2be9a02b43f748ee460bf36eed24fafa10992000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000009293c604c644bfac34f498998cc3402f203d4d6b00000000000000000000000000000000000000000000000000000000000000010000000000000000000000009293c604c644bfac34f498998cc3402f203d4d6b0000000000000000000000000000000000000000000000000000000000000064"
	assert.Equal(t, expect, data)
}

func TestContractManagementContract_UpdateVotingThreshold(t *testing.T) {
	contract := NewContractManagementContract()
	data, err := contract.UpdateVotingThreshold("0x5f2be9a02b43f748ee460bf36eed24fafa109920", 100)
	assert.Nil(t, err)
	expect := "0x65aba7570000000000000000000000005f2be9a02b43f748ee460bf36eed24fafa109920000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000055554313030000000000000000000000000000000000000000000000000000000"
	assert.Equal(t, expect, data)
}
